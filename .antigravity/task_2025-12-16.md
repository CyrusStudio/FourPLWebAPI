# 批次 MERGE 與錯誤處理

## 目標
- 正常時快速結束 (30,000 筆 < 30 秒)
- 有問題時回報哪筆資料失敗
- 出錯時移到 Fail 資料夾並建立失敗 Log 檔

## 任務清單

### 階段一：修改 Repository 支援批次 MERGE ✅
- [x] 新增 `UpsertBatchWithTempTableAsync<T>` 方法
- [x] 新增 `UpsertBatchResult` 和 `FailedItem` 類別
- [x] 實作逐筆處理並收集錯誤清單

### 階段二：修改處理流程 ✅
- [x] 更新 `ProcessFileAsync<T>` 使用新的批次方法
- [x] 新增 `WriteErrorLogAsync` 方法產生錯誤 Log 檔案

### 階段三：驗證 ✅
- [x] 建置成功 (0 警告、0 錯誤)
