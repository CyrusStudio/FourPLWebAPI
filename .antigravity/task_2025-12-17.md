# 資料轉換服務優化 - 任務清單

## 已完成項目 ✅

### 核心功能
- [x] 建立 `IDataTransformService` 介面（精簡版，只保留批次處理）
- [x] 實作 `DataTransformService` 批次處理邏輯
- [x] 建立 `DataTransformController`（只保留 `/pending` 端點）
- [x] 建立批次查詢模型 (`BatchQueryModels.cs`)

### 效能優化
- [x] 使用 `SqlBulkCopy` 批次寫入
- [x] 使用 LEFT JOIN 佇列表排除已處理項目
- [x] 移除暫存表，改用永久佇列表追蹤

### 佇列表機制
- [x] 建立 `FourPL_DataTrans_Queue_Verify` 表腳本
- [x] 實作 `MarkRequisitionsAsProcessedAsync` 寫入佇列
- [x] 三種類型查詢都加入佇列排除條件

### 程式碼清理
- [x] 刪除單筆 API 端點
- [x] 刪除單筆處理方法
- [x] 刪除舊的 Collect* 方法

## 待執行項目 ⏳

### 資料庫
- [ ] 在 SAPDS_QAS 執行 `CreateQueueVerifyTable.sql` 建立佇列表
- [ ] 驗證資料轉換結果

### 測試
- [ ] 執行 API 測試
- [ ] 驗證重複執行不會產生重複資料
